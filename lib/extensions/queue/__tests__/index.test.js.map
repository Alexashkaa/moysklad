{"version":3,"sources":["../../../../src/extensions/queue/__tests__/index.test.js"],"names":["test","require","Moysklad","sleep","QueueStamp","ExtendedMoysklad","compose","PRODUCT_ID","PRODUCT_NAME","t","ms","queue","comment","results","i","push","GET","then","p","name","Promise","all","ok","every","r"],"mappings":"AAAA;;;;AAEA,IAAMA,OAAOC,QAAQ,WAAR,CAAb;AACA,IAAMC,WAAWD,QAAQ,UAAR,CAAjB;AACA,IAAME,QAAQF,QAAQ,sBAAR,CAAd;;AAEA,IAAMG,aAAaH,QAAQ,IAAR,CAAnB;AACA,IAAMI,mBAAmBH,SAASI,OAAT,CAAiBF,UAAjB,CAAzB;;AAEA,IAAMG,aAAa,sCAAnB;AACA,IAAMC,eAAe,YAArB;;AAEAR,KAAK,gBAAL;AAAA,uDAAuB,iBAAMS,CAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACjBC,cADiB,GACZL,iBAAiB,EAAEM,OAAO,IAAT,EAAjB,CADY;;AAGrB;;AAHqB;AAAA,mBAIfR,MAAM,IAAN,CAJe;;AAAA;;AAMrBM,cAAEG,OAAF,CAAU,wCAAV;AACIC,mBAPiB,GAOP,EAPO;;AAQrB,iBAASC,CAAT,GAAa,CAAb,EAAgBA,IAAI,EAApB,EAAwBA,GAAxB,EAA6B;AAC3BD,sBAAQE,IAAR,CAAaL,GAAGM,GAAH,CAAO,CAAC,gBAAD,EAAmBT,UAAnB,CAAP,EAAuCU,IAAvC,CAA4C;AAAA,uBAAKC,EAAEC,IAAP;AAAA,eAA5C,CAAb;AACD;;AAVoB;AAAA,mBAYLC,QAAQC,GAAR,CAAYR,OAAZ,CAZK;;AAAA;AAYrBA,mBAZqB;;;AAcrBJ,cAAEa,EAAF,CAAKT,QAAQU,KAAR,CAAc;AAAA,qBAAKC,MAAMhB,YAAX;AAAA,aAAd,CAAL;;AAdqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAvB;;AAAA;AAAA;AAAA;AAAA","file":"index.test.js","sourcesContent":["'use strict'\n\nconst test = require('blue-tape')\nconst Moysklad = require('../../..')\nconst sleep = require('../../../tools/sleep')\n\nconst QueueStamp = require('..')\nconst ExtendedMoysklad = Moysklad.compose(QueueStamp)\n\nconst PRODUCT_ID = '8dff01c6-e06d-413c-a38f-6139eaf4c2c7'\nconst PRODUCT_NAME = 'Тест 9999+'\n\ntest('Moysklad queue', async t => {\n  let ms = ExtendedMoysklad({ queue: true })\n\n  // Сделаем паузу после предыдущих тестов\n  await sleep(1000)\n\n  t.comment('should plan request to avoid 429 error')\n  let results = []\n  for (let i = 1; i < 10; i++) {\n    results.push(ms.GET(['entity/product', PRODUCT_ID]).then(p => p.name))\n  }\n\n  results = await Promise.all(results)\n\n  t.ok(results.every(r => r === PRODUCT_NAME))\n})\n"]}