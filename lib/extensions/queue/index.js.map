{"version":3,"sources":["../../../src/extensions/queue/index.js"],"names":["stampit","require","Queue","globalQueuePull","Map","module","exports","init","options","login","fetchUri","fetchUriWithQueue","requestTask","apply","accountQueue","get","set","processTask","queue"],"mappings":"AAAA;;AAEA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,QAAQD,QAAQ,SAAR,CAAd;;AAEA,IAAIE,kBAAkB,IAAIC,GAAJ,EAAtB;;AAEAC,OAAOC,OAAP,GAAiBN,UAAUO,IAAV,CAAe,UAAUC,OAAV,EAAmB;AACjD,MAAIC,cAAJ;AAAA,MAAWC,iBAAX;;AAEA,WAASC,iBAAT,GAA8B;AAAA;AAAA;;AAC5B,QAAIC,cAAc,SAAdA,WAAc,GAAM;AACtB,aAAOF,SAASG,KAAT,mBAAP;AACD,KAFD;;AAIA;AACA,QAAIC,eAAeX,gBAAgBY,GAAhB,CAAoBN,KAApB,CAAnB;;AAEA,QAAI,CAACK,YAAL,EAAmB;AACjBA,qBAAe,IAAIZ,KAAJ,EAAf;AACAC,sBAAgBa,GAAhB,CAAoBP,KAApB,EAA2BK,YAA3B;AACD;;AAED,WAAOA,aAAaG,WAAb,CAAyBL,WAAzB,CAAP;AACD;;AAED,MAAIJ,QAAQU,KAAZ,EAAmB;AACjBT,YAAQD,QAAQC,KAAR,GAAgBD,QAAQC,KAAxB,GAAgC,IAAxC;AACAC,eAAW,KAAKA,QAAhB;AACA,SAAKA,QAAL,GAAgBC,iBAAhB;AACD;AACF,CAxBgB,CAAjB","file":"index.js","sourcesContent":["'use strict'\n\nconst stampit = require('stampit')\nconst Queue = require('./queue')\n\nlet globalQueuePull = new Map()\n\nmodule.exports = stampit().init(function (options) {\n  let login, fetchUri\n\n  function fetchUriWithQueue () {\n    let requestTask = () => {\n      return fetchUri.apply(this, arguments)\n    }\n\n    /** @type {Queue} */\n    let accountQueue = globalQueuePull.get(login)\n\n    if (!accountQueue) {\n      accountQueue = new Queue()\n      globalQueuePull.set(login, accountQueue)\n    }\n\n    return accountQueue.processTask(requestTask)\n  }\n\n  if (options.queue) {\n    login = options.login ? options.login : null\n    fetchUri = this.fetchUri\n    this.fetchUri = fetchUriWithQueue\n  }\n})\n"]}