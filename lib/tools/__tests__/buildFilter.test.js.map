{"version":3,"sources":["../../../src/tools/__tests__/buildFilter.test.js"],"names":["test","require","buildFilter","t","ok","equals","end","query","name","value","moment","Date","some","other","deepEqual","join","deep","tow","many","$eq","start","$st","$et","cont","$contains","$gt","num","$gte","$lt","$lte","$ne","$exists","$in","notMany","$nin","empty","$and","$not","fantom","throws","foo","undefined","Symbol","a"],"mappings":"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","file":"buildFilter.test.js","sourcesContent":["'use strict'\n\nconst test = require('blue-tape')\nconst buildFilter = require('../buildFilter')\n\ntest('buildFilter', t => {\n  t.ok(buildFilter)\n  t.equals(typeof buildFilter, 'function', 'should to be function')\n  t.end()\n})\n\ntest('buildFilter with simple filter', t => {\n  let query = {\n    name: 'foo',\n    value: 3,\n    moment: new Date('2017-01-09T19:15:06.556Z'),\n    some: null,\n    other: true\n  }\n\n  t.deepEqual(buildFilter(query), [\n    'moment=2017-01-09 22:15:06',\n    'name=foo',\n    'other=true',\n    'some=',\n    'value=3'\n  ].join(';'))\n\n  t.end()\n})\n\ntest('buildFilter with simple deep and many condition filter', t => {\n  let query = {\n    name: 'foo',\n    value: 0,\n    moment: new Date('2017-01-09T19:15:06.556Z'),\n    'deep.one': 5,\n    deep: {\n      tow: false\n    },\n    many: [1, 'baz']\n  }\n\n  t.deepEqual(buildFilter(query), [\n    'deep.one=5',\n    'deep.tow=false',\n    'many=1',\n    'many=baz',\n    'moment=2017-01-09 22:15:06',\n    'name=foo',\n    'value=0'\n  ].join(';'))\n\n  t.end()\n})\n\ntest('buildFilter with mogo query comparison selectors', t => {\n  let query = {\n    name: {\n      $eq: 'foo'\n    },\n    start: {\n      $st: 'prfx'\n    },\n    end: {\n      $et: 'psfx'\n    },\n    cont: {\n      $contains: 'str'\n    },\n    value: {\n      $gt: 5\n    },\n    num: {\n      $gte: 5, $lt: 10\n    },\n    moment: {\n      $lte: new Date('2017-01-09T19:15:06.556Z')\n    },\n    deep: {\n      tow: {\n        $ne: 'bar'\n      }\n    },\n    many: {\n      $exists: true,\n      $in: [1, 'baz']\n    },\n    notMany: {\n      $nin: [3, 6],\n      $gt: 0\n    },\n    empty: {\n      $exists: false\n    }\n  }\n\n  t.deepEqual(buildFilter(query), [\n    'cont~str',\n    'deep.tow!=bar',\n    'empty!=',\n    'end=~psfx',\n    'many!=',\n    'many=1',\n    'many=baz',\n    'moment<=2017-01-09 22:15:06',\n    'name=foo',\n    'notMany!=3',\n    'notMany!=6',\n    'notMany>0',\n    'num<10',\n    'num>=5',\n    'start~=prfx',\n    'value>5'\n  ].join(';'))\n\n  t.end()\n})\n\ntest('buildFilter with mogo query logical selectors', t => {\n  let query = {\n    name: {\n      $and: [\n        { $eq: 'foo' },\n        { $eq: 'bar' }\n      ]\n    },\n    value: {\n      $not: {\n        $eq: 10,\n        $in: [5, 6]\n      }\n    },\n    fantom: {\n      $not: {\n        $exists: true\n      }\n    }\n  }\n\n  t.deepEqual(buildFilter(query), [\n    'fantom=',\n    'name=bar',\n    'name=foo',\n    'value!=10',\n    'value!=5',\n    'value!=6'\n  ].join(';'))\n\n  t.end()\n})\n\ntest('buildFilter errors', t => {\n  t.throws(() => {\n    buildFilter()\n  }, /filter must to be an object/)\n\n  t.throws(() => {\n    buildFilter({ foo: undefined })\n  }, /filter \"foo\" key value is undefined/)\n\n  t.throws(() => {\n    buildFilter({ foo: Symbol('foo') })\n  }, /filter \"foo\" key value is incorrect/)\n\n  t.throws(() => {\n    buildFilter({ foo: { $eq: { a: 1 } } })\n  }, /\\$eq: value must to be string, number, date or null/)\n\n  t.throws(() => {\n    buildFilter({ foo: { $in: { a: 1 } } })\n  }, /\\$in: selector value must to be an array/)\n\n  t.throws(() => {\n    buildFilter({ foo: { $and: { a: 1 } } })\n  }, /\\$and: selector value must to be an array/)\n\n  t.throws(() => {\n    buildFilter({ foo: { $not: 3 } })\n  }, /\\$not: selector value must to be an object/)\n\n  t.throws(() => {\n    buildFilter({ foo: { $not: { $st: 'start' } } })\n  }, /\\$st not support negation/)\n\n  t.throws(() => {\n    buildFilter({ foo: { $not: { $et: 'start' } } })\n  }, /\\$et not support negation/)\n\n  t.throws(() => {\n    buildFilter({ foo: { $not: { $contains: 'start' } } })\n  }, /\\$contains not support negation/)\n\n  t.throws(() => {\n    buildFilter({ foo: { $exists: 'boo' } })\n  }, /\\$exists: selector value must to be boolean/)\n\n  t.end()\n})\n\n// debugger\n"]}